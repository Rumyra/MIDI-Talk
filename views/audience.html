<!DOCTYPE html>
<html lang="en">
<head>
  <!--char set (lang above)-->
  <meta charset="utf-8">

  <!--device/browser shizzle-->
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!--meta content-->
  <link rel="shortcut icon" href="favicon.ico" />
  
  <meta name="author" content="Ruth John (@rumyra)">
  <meta name="dcterms.rightsHolder" content="Ruth John for Rumyra Ltd, United Kingdom, 2015">
  <title>Let's talk about MIDI!</title>

  <link href="public/css/audience.css" rel="stylesheet" type="text/css">
  <script src="https://js.pusher.com/3.0/pusher.min.js"></script>
  
</head>
<body class="audience">

  <!-- probably don't need this -->
  <div id="intro">
    <h2>Let's Talk About MIDI</h2>
    <p>An interactive presentation by @rumyra</p>
  </div>

  <audio src="public/octave/c4.mp3" data-note="60"></audio>

  <div class="page" id="keyboard-data" data-state="show-data">

    <section id="midi-data">
      <ul></ul>
    </section>

    <div class="instrument" id="keyboard">
      <section id="octave">
        <b class="key-af" data-note="56">Ab</b>
        <i class="key-a" data-note="57">A</i>
        <b class="key-bf" data-note="58">Bb</b>
        <i class="key-b" data-note="59">B</i>
        <i class="key-c" data-note="60">C</i>
        <b class="key-cs" data-note="61">C#</b>
        <i class="key-d" data-note="62">D</i>
        <b class="key-ef" data-note="63">Eb</b>
        <i class="key-e" data-note="64">E</i>
        <i class="key-f" data-note="65">F</i>
        <b class="key-fs" data-note="66">F#</b>
        <i class="key-g" data-note="67">G</i>
        <b class="key-af" data-note="68">Ab</b>
        <i class="key-a" data-note="69">A</i>
        <b class="key-bf key-last" data-note="70">Bb</b>
      </section>
    </div><!--instrument-->
  </div><!--container-->

<script type="text/javascript">
//Give the Audio element a stop function
HTMLAudioElement.prototype.stop = function()
{
    this.pause();
    this.currentTime = 0.0;
}
//persist data-state

//show/hide correct dom based on data state

//keyboard-data - run correct function based on data state
var allKeys = document.getElementById('octave').children,
    dataList = document.querySelector('#midi-data ul'),
    audioTracks = document.getElementsByTagName('audio');
    console.log(audioTracks);

for (var i=0; i<allKeys.length; i++) {
  allKeys[i].addEventListener('mousedown', function() {
    var newItem = document.createElement('li');
newItem.appendChild(document.createTextNode('[144,'+this.dataset.note+',100]'));
    dataList.appendChild(newItem);

    audioTracks[0].play();
  });
    allKeys[i].addEventListener('mouseup', function() {
    var newItem = document.createElement('li');
newItem.appendChild(document.createTextNode('[128,'+this.dataset.note+',64]'));
    dataList.appendChild(newItem);
    audioTracks[0].stop();
  });
}
</script>

</body>
</html>